<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Video Details</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div>
    <h5 th:text="${video.title}" class="m-3">Video Title</h5>
    <div class="video-container m-3">
        <iframe width="700" height="315" th:src="@{${'https://www.youtube.com/embed/'+video.videoId+'?autoplay=1'}}" frameborder="0" allowfullscreen allow="autoplay"></iframe>
    </div>
</div>
<div>
    <h2>View Count</h2>
    <p th:text="${video.viewCount}"></p>
</div>
<div>
    <form id="likeForm" th:action="@{${'/user/likeOrDislike/'+video.id+'/LIKE'}}">
        <button type="button" class="btn btn-primary click" onclick="likeVideo()">Like</button>
        <p id="likeCount" th:text="${video.likeCount}"></p>
    </form>
</div>
<div>
    <form id="dislikeForm" th:action="@{${'/user/likeOrDislike/'+video.id+'/DISLIKE'}}">
        <button type="button" class="btn btn-danger click" onclick="dislikeVideo()">Dislike</button>
        <p id="dislikeCount" th:text="${video.dislikeCount}"></p>
    </form>
</div>

<div class="m-3">
    <form th:action="@{${'/user/likedUsers/'+video.videoId}}">
        <button type="submit" class="btn btn-secondary">Liked User List</button>
    </form>
</div>

<div class="m-3">
    <form th:action="@{${'/user/dislikedUsers/'+video.videoId}}">
        <button type="submit" class="btn btn-secondary">DisLiked User List</button>
    </form>
</div>
<div>
    <a href="/user/userHome" class="btn btn-primary float-right">Return Home Page</a>
</div>


<script th:inline="javascript">
    function likeVideo() {
    var videoId = /*[[${video.id}]]*/ '';
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/user/likeOrDislike/' + videoId + '/LIKE', true);
    xhr.onload = function () {
        if (xhr.status === 200) {
            var likeOrDislikeCount = JSON.parse(xhr.responseText);
            document.getElementById('likeCount').innerText = likeOrDislikeCount[0];
            document.getElementById('dislikeCount').innerText = likeOrDislikeCount[1];
        }
    };
    xhr.send();
}


    function dislikeVideo() {
    var videoId = /*[[${video.id}]]*/ '';
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/user/likeOrDislike/' + videoId + '/DISLIKE', true);
    xhr.onload = function () {
        if (xhr.status === 200) {
            var likeOrDislikeCount = JSON.parse(xhr.responseText);
            document.getElementById('likeCount').innerText = likeOrDislikeCount[0];
            document.getElementById('dislikeCount').innerText = likeOrDislikeCount[1];
        }
    };
    xhr.send();
}
</script>

</body>
</html>
